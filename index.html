<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>BEDCHI Archive</title>
    
    <!-- Vision Pro Optimizations -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="BEDCHI">
    <meta name="supported-color-schemes" content="dark">
    
    <!-- Preload critical 3D viewer -->
    <link rel="modulepreload" href="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js">
    
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.3.0/model-viewer.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #000000;
            color: #ffffff;
            min-height: 100vh;
        }

        nav {
            background: rgba(0, 0, 0, 0.95);
            border-bottom: 1px solid rgba(102, 126, 234, 0.3);
            padding: 0;
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
        }

        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0;
            height: 70px;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 500;
            padding: 0 30px;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            display: inline-block;
            height: 70px;
            line-height: 70px;
        }

        .nav-link:hover {
            color: #ffffff;
            background: rgba(102, 126, 234, 0.1);
            border-bottom-color: rgba(102, 126, 234, 0.5);
        }

        .nav-link.active {
            color: #ffffff;
            background: rgba(102, 126, 234, 0.15);
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .site-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            flex-wrap: wrap;
        }

        .logo {
            max-width: 500px;
            width: 100%;
            height: auto;
            filter: invert(1) brightness(2);
        }

        .archive-title {
            color: #ffffff;
            font-size: 2.5em;
            margin-top: 30px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .instructions-banner {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .instructions-banner h3 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .instructions-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .instructions-list li {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1em;
            line-height: 1.6;
            padding-left: 30px;
            position: relative;
        }

        .instructions-list li::before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 40px;
            font-size: 2.5em;
            font-weight: 700;
            letter-spacing: -1px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
            align-items: start;
        }

        .model-library {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 20px;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .model-library h2 {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #ffffff;
            font-weight: 600;
        }

        .culture-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .culture-tab {
            flex: 1;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.6);
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .culture-tab:hover {
            background: rgba(255, 255, 255, 0.06);
            color: rgba(255, 255, 255, 0.8);
            border-color: rgba(255, 126, 34, 0.3);
        }

        .culture-tab.active {
            background: rgba(255, 126, 34, 0.2);
            border-color: rgba(255, 126, 34, 0.5);
            color: #ff7e22;
            font-weight: 600;
        }

        .category-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-tab {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .category-tab:hover {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.9);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .category-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: #ffffff;
            font-weight: 600;
        }

        .model-card {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .model-card:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateX(5px);
        }

        .model-card.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .model-info {
            flex-grow: 1;
        }

        .model-name {
            font-weight: 600;
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .model-preview-label {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.6);
        }

        .viewer-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .viewer-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 20px;
            min-height: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #ff7e22;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-spinner p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 1.1em;
            margin: 0;
        }

        model-viewer {
            width: 100%;
            height: 500px;
            border-radius: 10px;
            background: transparent;
        }

        .placeholder {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            padding: 40px;
        }

        .placeholder-icon {
            font-size: 5em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .placeholder h2 {
            font-size: 1.8em;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .placeholder p {
            font-size: 1.1em;
            color: rgba(255, 255, 255, 0.4);
        }

        .model-description {
            margin-top: 25px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .model-description h3 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .metadata-field {
            margin-bottom: 15px;
        }

        .metadata-label {
            font-size: 0.85em;
            color: rgba(255, 255, 255, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .metadata-value {
            font-size: 1em;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.9);
        }

        .metadata-description {
            font-size: 1.05em;
            line-height: 1.8;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Video Player */
        .video-section {
            margin-top: 25px;
            padding: 25px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .video-section h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #ff7e22;
            font-weight: 600;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #000;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .video-container video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .video-caption {
            font-size: 0.95em;
            line-height: 1.6;
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }

        .video-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .video-placeholder-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }



            content: '';
            position: absolute;
            width: 2px;
            height: 10px;
            background: #ff7e22;
            top: -3px;
        }

            left: 0;
        }

            right: 0;
        }


        footer {
            background: rgba(0, 0, 0, 0.95);
            border-top: 1px solid rgba(102, 126, 234, 0.3);
            margin-top: 60px;
            padding: 40px 0 20px;
        }

        .footer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }

        .footer-section h3 {
            color: #ff7e22;
            font-size: 1.1em;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .footer-section p,
        .footer-section a {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.95em;
            line-height: 1.8;
            text-decoration: none;
            display: block;
            margin-bottom: 8px;
        }

        .footer-section a:hover {
            color: #667eea;
        }

        .footer-bottom {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
            text-align: center;
        }

        .footer-bottom p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9em;
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .footer-content {
                grid-template-columns: 1fr;
                gap: 30px;
            }
        }

        .ar-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2em;
            border-radius: 30px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
            transition: all 0.3s ease;
        }

        .ar-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .button-container {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
            justify-content: center;
            text-align: center;
        }

        .play-audio-button {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2em;
            border-radius: 30px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(52, 211, 153, 0.4);
            transition: all 0.3s ease;
            display: none;
        }

        .play-audio-button.active {
            display: inline-block;
        }

        .play-audio-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 25px rgba(52, 211, 153, 0.6);
        }

        .play-audio-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .audio-controls {
            margin-top: 20px;
            display: none;
        }

        .audio-controls.active {
            display: block;
        }

        audio {
            width: 100%;
            max-width: 400px;
            border-radius: 10px;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .model-library {
                position: static;
                max-height: none;
            }

            .logo {
                max-width: 90%;
            }

            .logo-container {
                gap: 30px;
            }
        }

        @media (max-width: 600px) {
            .nav-container {
                padding: 0;
                height: auto;
                flex-wrap: wrap;
            }

            .nav-link {
                padding: 18px 20px;
                font-size: 0.75em;
                height: auto;
                line-height: normal;
            }

            .logo {
                max-width: 100%;
            }

            .logo-container {
                gap: 20px;
            }

            .site-header {
                padding: 20px 10px;
                margin-bottom: 30px;
            }

            .instructions-banner {
                padding: 15px 20px;
                margin-bottom: 20px;
            }

            .instructions-banner h3 {
                font-size: 1.1em;
                margin-bottom: 12px;
            }

            .instructions-list {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .instructions-list li {
                font-size: 0.9em;
            }

            .model-card {
                padding: 15px;
            }

            .model-name {
                font-size: 1.1em;
            }
        }

        /* Funders Banner */
        .funders-banner {
            background: rgba(255, 255, 255, 0.03);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 40px 20px;
            margin-top: 60px;
        }

        .funders-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .funders-container h3 {
            color: #ff7e22;
            font-size: 1.1em;
            margin-bottom: 30px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .funders-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 60px;
            flex-wrap: wrap;
        }

        .funder-logo {
            max-width: 200px;
            height: 80px;
            object-fit: contain;
            opacity: 0.9;
            transition: opacity 0.3s ease;
        }

        .funder-logo:hover {
            opacity: 1;
        }

        /* Vision Pro Optimizations */
        @media (min-width: 1920px) and (min-height: 1080px) {
            /* Larger displays like Vision Pro */
            body {
                font-size: 18px;
            }
            
            .archive-title {
                font-size: 3.5em;
            }
            
            model-viewer {
                height: 800px;
            }
            
            .model-card {
                padding: 25px;
            }
            
            .model-name {
                font-size: 1.4em;
            }
        }
        
        /* Enhanced touch targets for Vision Pro gestures */
        @supports (-webkit-overflow-scrolling: touch) {
            button, .model-card, .nav-link {
                min-height: 44px;
                min-width: 44px;
            }
        }
        
        /* Smooth scrolling for Vision Pro */
        * {
            -webkit-overflow-scrolling: touch;
            scroll-behavior: smooth;
        }

        @media (max-width: 768px) {
            .funders-logos {
                gap: 40px;
            }

            .funder-logo {
                max-width: 150px;
                height: 60px;
            }
        }

        .footer-funders {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .footer-funders h4 {
            color: #ff7e22;
            font-size: 0.9em;
            margin-bottom: 15px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .footer-funders-logos {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .footer-funder-logo {
            max-width: 120px;
            height: 50px;
            object-fit: contain;
            opacity: 0.85;
            transition: opacity 0.3s ease;
        }

        .footer-funder-logo:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .footer-funders-logos {
                gap: 15px;
            }

            .footer-funder-logo {
                max-width: 100px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <a href="index.html" class="nav-link active">Archive</a>
            <a href="about/" class="nav-link">About</a>
            <a href="people/" class="nav-link">People</a>
            <a href="partners/" class="nav-link">Partners</a>
            <a href="get-involved/" class="nav-link">Get Involved</a>
            <a href="contact/" class="nav-link">Contact</a>
        </div>
    </nav>

    <div class="container">
        <header class="site-header">
            <div class="logo-container">
                <img src="bedchi-logo.png" alt="BEDCHI - Bears Ears Digital Cultural Heritage Initiative" class="logo">
            </div>
            <h1 class="archive-title">Digital Archive</h1>
        </header>

        <div class="instructions-banner">
            <h3>Instructions</h3>
            <ul class="instructions-list" id="instructionsList">
                <!-- Instructions will be dynamically loaded based on platform -->
            </ul>
        </div>
        
        <div class="main-content">
            <!-- Left Column: Model Library -->
            <div class="model-library">
                <h2>BEDCHI Digital Archive</h2>
                <div class="culture-tabs">
                    <button class="culture-tab active" data-culture="all">All Cultures</button>
                    <button class="culture-tab" data-culture="navajo">Navajo</button>
                    <button class="culture-tab" data-culture="zuni">Zuni</button>
                </div>
                <div class="category-tabs">
                    <button class="category-tab active" data-category="objects">Objects</button>
                    <button class="category-tab" data-category="sites">Sites and Landscapes</button>
                </div>
                <div id="modelLibrary"></div>
            </div>

            <!-- Right Column: Viewer and Description -->
            <div class="viewer-section">
                <div class="viewer-container">
                    <div id="placeholder" class="placeholder">
                        <div class="placeholder-icon">ðŸŽ¨</div>
                        <h2>Select a model to begin</h2>
                        <p>Choose from the library to view in 3D and AR</p>
                    </div>
                    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                        <p>Loading model...</p>
                    </div>
                    <model-viewer id="viewer" 
                        style="display: none;"
                        camera-controls 
                        touch-action="pan-y"
                        ar
                        ar-modes="webxr scene-viewer quick-look"
                        shadow-intensity="1"
                        shadow-softness="1"
                        ar-placement="floor"
                        
                        exposure="1.2"
                        tone-mapping="commerce"
                        environment-image="neutral"
                        
                        max-camera-orbit="auto auto 10m"
                        min-camera-orbit="auto auto 0.5m"
                        
                        interaction-prompt="auto"
                        interaction-prompt-threshold="500"
                        
                        reveal="auto">
                        <button slot="ar-button" class="ar-button">
                            ðŸ“± View in AR
                        </button>
                    </model-viewer>
                </div>
                
                <div class="button-container">
                    <button id="playAudioButton" class="play-audio-button">
                        ðŸ”Š Play Audio
                    </button>
                </div>
                <div id="audioControls" class="audio-controls">
                    <audio id="audioPlayer" controls></audio>
                </div>
                
                <div id="modelDescription" class="model-description" style="display: none;">
                    <h3 id="descriptionTitle"></h3>
                    <div class="metadata-field" id="metadataField1">
                        <div class="metadata-label" id="metadataLabel1"></div>
                        <div class="metadata-value" id="metadataValue1"></div>
                    </div>
                    <div class="metadata-field" id="metadataField2">
                        <div class="metadata-label" id="metadataLabel2"></div>
                        <div class="metadata-value" id="metadataValue2"></div>
                    </div>
                    <div class="metadata-description" id="metadataDescription"></div>
                </div>

                <!-- Video Player Section -->
                <div id="videoSection" class="video-section" style="display: none;">
                    <h3>ðŸ“¹ Related Video</h3>
                    <div class="video-container">
                        <video id="videoPlayer" 
                               controls 
                               preload="none"
                               playsinline
                               webkit-playsinline
                               x-webkit-airplay="allow"
                               disablePictureInPicture
                               controlslist="nodownload"
                               style="max-height: 400px;">
                            <source id="videoSource" src="" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                        <div id="videoPlaceholder" class="video-placeholder">
                            <div class="video-placeholder-icon">ðŸŽ¬</div>
                            <p>No video available for this item</p>
                        </div>
                    </div>
                    <p id="videoCaption" class="video-caption"></p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About BEDCHI</h3>
                    <p>
                        The Bears Ears Digital Cultural Heritage Initiative documents and interprets cultural heritage sites and landscapes through 3D scanning, immersive visualization, and community-engaged research in partnership with Indigenous communities, researchers, and land managers.
                    </p>
                    <div class="footer-funders">
                        <h4>Major Funders</h4>
                        <div class="footer-funders-logos">
                            <img src="partners/ifr-logo.png" alt="Institute for Field Research" class="footer-funder-logo">
                            <img src="partners/cnha-logo.png" alt="Canyonlands Natural History Association" class="footer-funder-logo">
                            <img src="partners/nhmlac-logo.png" alt="Natural History Museum of Los Angeles County" class="footer-funder-logo">
                        </div>
                    </div>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="index.html">Archive</a>
                    <a href="about/">About</a>
                    <a href="people/">People</a>
                    <a href="partners/">Partners</a>
                    <a href="get-involved/">Get Involved</a>
                    <a href="contact/">Contact</a>
                </div>
                <div class="footer-section">
                    <h3>Contact</h3>
                    <a href="/cdn-cgi/l/email-protection#3e5b4c575d565b52527e4b4d5d105b5a4b"><span class="__cf_email__" data-cfemail="6500170c060d000909251016064b000110">[email&#160;protected]</span></a>
                    <p style="margin-top: 15px;">
                        University of Southern California<br>
                        Department of Anthropology
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Bears Ears Digital Cultural Heritage Initiative. All rights reserved.</p>
                <p>Created in collaboration with tribal partners, universities, museums, and federal agencies.</p>
            </div>
        </div>
    </footer>

    <script>
        // Wait for DOM to be fully loaded before running code
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing BEDCHI Archive...');
            
        // Library of 3D models
        // For USDZ files: provide the filename you uploaded to GitHub
        // The 'url' is used for browser 3D preview (use GLB for best results)
        // The 'iosUrl' (if provided) is used specifically for AR on iOS (use USDZ)
        // The 'audio' (optional) is the audio file to play when model loads
        // The 'metadata' contains detailed information displayed in the right column
        const models = [
            // Models with Video (3)
            {
                name: 'Seed Jar',
                category: 'objects',
                culture: 'zuni',
                url: 'models/seed-jar/seed-jar.glb',
                iosUrl: 'models/seed-jar/seed-jar.usdz',
                audio: 'models/seed-jar/seed-jar.mp3',
                video: 'models/seed-jar/seed-jar.mp4',
                videoCaption: 'Demonstration of traditional Zuni seed storage and scattering ceremonies, explaining the cultural significance of seed jars in agricultural practices.',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'F.A.109.91-234',
                    description: 'A traditional Zuni seed jar used for storing and scattering seeds during agricultural ceremonies and planting seasons. These specialized vessels play a vital role in Zuni agricultural practices, connecting material culture with spiritual beliefs about fertility, growth, and the cycle of life. The jar\'s design reflects both practical functionality and ceremonial significance.'
                }
            },
            {
                name: 'Gourd Rattle',
                category: 'objects',
                culture: 'zuni',
                url: 'models/rattle/rattle.glb',
                iosUrl: 'models/rattle/rattle.usdz',
                audio: 'models/rattle/rattle.mp3',
                video: 'models/rattle/rattle.mp4',
                videoCaption: 'Demonstration of traditional gourd rattle use in Zuni ceremonial dances and songs, showing playing techniques and cultural context.',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'A.4515.30-76',
                    description: 'A traditional Zuni gourd rattle used in ceremonial dances, songs, and religious observances. These rattles produce distinctive rhythmic sounds that accompany sacred performances and prayers. The gourd rattle exemplifies the integration of natural materials with ceremonial practice, serving as both a musical instrument and a spiritual tool in Zuni cultural traditions.'
                }
            },
            {
                name: 'Rainbird Vessel',
                category: 'objects',
                culture: 'zuni',
                url: 'models/rainbird/rainbird.glb',
                iosUrl: 'models/rainbird/rainbird.usdz',
                audio: 'models/rainbird/rainbird.mp3',
                video: 'models/rainbird/rainbird.mp4',
                videoCaption: 'Exploration of rainbird symbolism in Zuni pottery, discussing the cultural significance of water and rain imagery in Pueblo traditions.',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'A.4850.40-1',
                    description: 'A ceramic vessel featuring rainbird imagery, a powerful symbol in Zuni and broader Pueblo culture representing the connection between water, life, and spiritual practice. Rainbirds are messengers that bring rain and ensure agricultural fertility. This vessel demonstrates the integration of naturalistic bird forms with ceremonial and utilitarian pottery, showcasing the artistic and symbolic sophistication of Zuni ceramic traditions.'
                }
            },
            // Zuni Objects (Audio Only)
            {
                name: 'Owl Effigy Vessel',
                category: 'objects',
                culture: 'zuni',
                url: 'models/owl/owl.glb',
                iosUrl: 'models/owl/owl.usdz',
                audio: 'models/owl/owl.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'A.8590.66-3',
                    description: 'A ceramic owl effigy vessel from the Zuni tradition. This functional pottery piece is shaped in the form of an owl, combining artistic representation with practical use. Effigy vessels like this demonstrate the integration of spiritual symbolism and daily life in Zuni material culture. Owls hold particular significance in Pueblo cosmology.'
                }
            },
            {
                name: 'Jar',
                category: 'objects',
                culture: 'zuni',
                url: 'models/jar/jar.glb',
                iosUrl: 'models/jar/jar.usdz',
                audio: 'models/jar/jar.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'F.A.109.91-241',
                    description: 'A ceramic jar representing traditional pottery techniques from the Bears Ears region. The vessel exhibits characteristic construction methods and surface treatments typical of the area\'s cultural heritage.'
                }
            },
            {
                name: 'Mug',
                category: 'objects',
                culture: 'zuni',
                url: 'models/mug/Mug.glb',
                iosUrl: 'models/mug/Mug.usdz',
                audio: 'models/mug/Mug.mp3',
                metadata: {
                    museum: 'Edge of the Cedars State Park Museum',
                    accession: '',
                    description: 'A ceramic mug demonstrating functional pottery design and construction. This piece illustrates everyday utilitarian objects and their role in material culture studies.'
                }
            },
            {
                name: 'Tarus',
                category: 'objects',
                culture: 'zuni',
                url: 'models/tarus/tarus.glb',
                iosUrl: 'models/tarus/tarus.usdz',
                audio: 'models/tarus/tarus.mp3',
                metadata: {
                    museum: 'Edge of the Cedars State Park Museum',
                    accession: '',
                    description: 'A detailed 3D model from the Bears Ears region. This artifact provides insight into the material culture and craftsmanship of the area\'s indigenous peoples.'
                }
            },
            {
                name: 'Bear',
                category: 'objects',
                culture: 'zuni',
                url: 'models/bear/bear.glb',
                iosUrl: 'models/bear/bear.usdz',
                audio: 'models/bear/bear.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'F.P.4.2015-29',
                    description: 'A bear artifact from the Bears Ears region, representing the cultural and symbolic significance of bears in indigenous traditions and material culture.'
                }
            },
            {
                name: 'Pueblo Stone Carving',
                category: 'objects',
                culture: 'zuni',
                url: 'models/pueblo-stone/pueblo-stone.glb',
                iosUrl: 'models/pueblo-stone/pueblo-stone.usdz',
                audio: 'models/pueblo-stone/pueblo-stone.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'F.P.4.2013-4',
                    description: 'A Zuni fetish carving depicting an eagle flying over a pueblo. This stone carving exemplifies the Zuni tradition of creating fetish figures that embody spiritual power and connection between the natural and built worlds. Eagles hold sacred significance in Pueblo cultures, representing strength, vision, and the connection between earth and sky.'
                }
            },
            {
                name: 'Waterbird Vessel',
                category: 'objects',
                culture: 'zuni',
                url: 'models/waterbird/waterbird.glb',
                iosUrl: 'models/waterbird/waterbird.usdz',
                audio: 'models/waterbird/waterbird.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'A.6076.80-24',
                    description: 'A ceramic vessel featuring waterbird imagery, representing the vital relationship between water, wildlife, and Zuni life. Waterbirds serve as symbols of aquatic abundance and the importance of wetland environments in Pueblo cosmology. This vessel exemplifies traditional Zuni pottery techniques while incorporating naturalistic depictions of birds associated with water sources, reflecting the cultural significance of water in the arid Southwest.'
                }
            },
            {
                name: 'Duck Vessel 1',
                category: 'objects',
                culture: 'zuni',
                url: 'models/duck-1/duck-1.glb',
                iosUrl: 'models/duck-1/duck-1.usdz',
                audio: 'models/duck-1/duck-1.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'A.5759-13',
                    description: 'A ceramic duck effigy vessel showcasing traditional Zuni pottery artistry. Ducks hold cultural significance as water-associated creatures, connecting to themes of migration, seasonal cycles, and aquatic resources. This vessel demonstrates the skilled craftsmanship of Zuni potters in creating naturalistic animal forms that blend functional and ceremonial purposes.'
                }
            },
            // Zuni Sites
            {
                name: 'Rock Info',
                category: 'sites',
                culture: 'zuni',
                url: 'models/rock-info/rock-info.glb',
                iosUrl: 'models/rock-info/rock-info.usdz',
                audio: 'models/rock-info/rock-info.mp3',
                metadata: {
                    location: 'Bears Ears National Monument, Utah',
                    date: '2024',
                    description: 'A 3D model of a culturally significant rock formation or landscape feature from the Bears Ears region. This digital documentation preserves the spatial context and geological characteristics of the site.'
                }
            },
            {
                name: 'Moon Room',
                category: 'sites',
                culture: 'zuni',
                url: 'models/moon-room/moon-room.glb',
                iosUrl: 'models/moon-room/moon-room.usdz',
                audio: 'models/moon-room/moon-room.mp3',
                isInterior: true,
                cameraOrbit: '0deg 90deg 0.01m',
                cameraTarget: '0m 0m 0m',
                fieldOfView: '75deg',
                minCameraOrbit: 'auto auto 0.01m',
                maxCameraOrbit: 'auto auto 0.01m',
                disableEnvironmentImage: true,
                shadowIntensity: 0,
                disableZoom: true,
                metadata: {
                    location: 'Bears Ears National Monument, Utah',
                    date: '2024',
                    description: 'An immersive 3D model of the Moon Room interior. Users experience this culturally significant archaeological space from within, exploring architectural features and cultural significance as if standing inside the room itself. This digital documentation preserves the spatial experience of this important Zuni ancestral site.'
                }
            },
            // Navajo Objects & Sites
            {
                name: "Laura's Hogan",
                category: 'sites',
                culture: 'navajo',
                url: 'models/lauras-hogan/lauras-hogan-web.glb',
                iosUrl: 'models/lauras-hogan/lauras-hogan.usdz',
                audio: 'models/lauras-hogan/lauras-hogan.mp3',
                metadata: {
                    location: 'Bears Ears National Monument, Utah',
                    date: '2024',
                    description: 'A 3D model of a traditional Navajo hogan structure. Hogans are sacred dwellings central to Navajo culture and spiritual practice. This digital documentation preserves the architectural details and spatial context of this culturally significant structure.'
                }
            },
            {
                name: 'Textile',
                category: 'objects',
                culture: 'navajo',
                url: 'models/textile/textile.glb',
                iosUrl: 'models/textile/textile.usdz',
                audio: 'models/textile/textile.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'A.5141.42-38',
                    description: 'A traditional Navajo textile showcasing intricate weaving patterns and techniques passed down through generations. Navajo textiles are renowned for their geometric designs and use of natural dyes, representing both artistic excellence and cultural identity.'
                }
            },
            {
                name: 'Vessel',
                category: 'objects',
                culture: 'navajo',
                url: 'models/vessel/vessel.glb',
                iosUrl: 'models/vessel/vessel.usdz',
                audio: 'models/vessel/vessel.mp3',
                metadata: {
                    museum: 'Natural History Museum of Los Angeles County',
                    accession: 'A.5277.43-19',
                    description: 'A Navajo ceramic vessel demonstrating traditional pottery techniques and designs. This functional piece reflects the practical artistry of Navajo material culture and the continuation of ceramic traditions in the region.'
                }
            }
        ];

        const modelLibrary = document.getElementById('modelLibrary');
        const viewer = document.getElementById('viewer');
        const placeholder = document.getElementById('placeholder');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const audioPlayer = document.getElementById('audioPlayer');
        const audioControls = document.getElementById('audioControls');
        const playAudioButton = document.getElementById('playAudioButton');
        const modelDescription = document.getElementById('modelDescription');
        const descriptionTitle = document.getElementById('descriptionTitle');
        const metadataLabel1 = document.getElementById('metadataLabel1');
        const metadataValue1 = document.getElementById('metadataValue1');
        const metadataLabel2 = document.getElementById('metadataLabel2');
        const metadataValue2 = document.getElementById('metadataValue2');
        const metadataDescription = document.getElementById('metadataDescription');
        let selectedModel = null;
        let currentCategory = 'objects';
        let currentCulture = 'all';

        // Culture tab switching
        document.querySelectorAll('.culture-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Update active tab
                document.querySelectorAll('.culture-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update current culture
                currentCulture = tab.dataset.culture;
                
                // Clear viewer and show placeholder
                viewer.src = '';
                viewer.removeAttribute('ios-src');
                viewer.style.display = 'none';
                placeholder.style.display = 'flex';
                modelDescription.style.display = 'none';
                selectedModel = null;
                
                // Stop and clear audio
                audioPlayer.pause();
                audioPlayer.src = '';
                playAudioButton.classList.remove('active');
                audioControls.classList.remove('active');
                
                // Re-render model library
                renderModels();
            });
        });

        // Category tab switching
        document.querySelectorAll('.category-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Update active tab
                document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                // Update current category
                currentCategory = tab.dataset.category;
                
                // Re-render model library
                renderModels();
            });
        });

        function renderModels() {
            // Clear current models
            modelLibrary.innerHTML = '';
            
            console.log('Rendering models - category:', currentCategory, 'culture:', currentCulture);
            console.log('Total models:', models.length);
            
            // Filter models by both category and culture
            const filteredModels = models.filter(model => {
                const matchesCategory = model.category === currentCategory;
                const matchesCulture = currentCulture === 'all' || model.culture === currentCulture;
                console.log('Model:', model.name, 'Category match:', matchesCategory, 'Culture match:', matchesCulture);
                return matchesCategory && matchesCulture;
            });
            
            console.log('Filtered models:', filteredModels.length);
            
            filteredModels.forEach((model, filteredIndex) => {
                const originalIndex = models.indexOf(model);
                const card = document.createElement('div');
                card.className = 'model-card';
                card.dataset.index = originalIndex;
                card.innerHTML = `
                    <div class="model-info">
                        <div class="model-name">${model.name}</div>
                        <div class="model-preview-label">Tap to preview</div>
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    selectModel(originalIndex, card);
                });
                
                modelLibrary.appendChild(card);
            });
            
            console.log('Cards appended to library');
        }

        // Platform Detection
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        const isVisionPro = navigator.userAgent.includes('VisionOS') || 
                           (window.screen.width >= 1920 && window.screen.height >= 1080);
        const isDesktop = !isMobile && !isVisionPro;
        
        // Load platform-specific instructions
        const instructionsList = document.getElementById('instructionsList');
        let instructions = [];
        
        if (isVisionPro) {
            // Vision Pro instructions
            instructions = [
                'Look at a model card and pinch to select',
                'Use pinch and drag to rotate the 3D model',
                'Pinch to zoom in and out',
                'Tap "Play Audio" for narration',
                'Tap "View in Spatial Reality" to place in your space'
            ];
        } else if (isMobile) {
            // Mobile/Tablet instructions
            instructions = [
                'Tap a model from the library',
                'Swipe to rotate, pinch to zoom',
                'Tap "Play Audio" for information',
                'Tap "View in AR" to place in your space'
            ];
        } else {
            // Desktop instructions
            instructions = [
                'Click a model from the library',
                'Click and drag to rotate the 3D preview',
                'Scroll to zoom in and out',
                'Click "Play Audio" for information',
                'Use "View in AR" on mobile devices'
            ];
        }
        
        // Populate instructions
        instructions.forEach(instruction => {
            const li = document.createElement('li');
            li.textContent = instruction;
            instructionsList.appendChild(li);
        });
        
        // Update instructions based on platform (reuse the same instructionsList)
        if (instructionsList) {
            instructionsList.innerHTML = '';
            
            if (isVisionPro) {
                // Vision Pro instructions
                instructionsList.innerHTML = `
                    <li>Select a model with eye gaze and pinch</li>
                    <li>Pinch and drag to rotate models</li>
                    <li>Tap "Play Audio" for spatial narration</li>
                    <li>Tap "View in Spatial Reality" for AR</li>
                `;
            } else if (isMobile) {
                // Mobile/tablet instructions
                instructionsList.innerHTML = `
                    <li>Tap a model from the library</li>
                    <li>Swipe to rotate, pinch to zoom</li>
                    <li>Tap "Play Audio" for information</li>
                    <li>Tap "View in AR" to place in your space</li>
                `;
            } else {
                // Desktop instructions
                instructionsList.innerHTML = `
                    <li>Click a model from the library</li>
                    <li>Click and drag to rotate, scroll to zoom</li>
                    <li>Click "Play Audio" for information</li>
                    <li>Use mobile device for AR viewing</li>
                `;
            }
        }
        
        if (isVisionPro) {
            console.log('Vision Pro detected - enabling enhanced features');
            
            // Enhance model-viewer for Vision Pro
            viewer.setAttribute('exposure', '1.4');
            viewer.setAttribute('environment-image', 'neutral');
            
            // Update AR button text for Vision Pro
            const arButton = viewer.querySelector('[slot="ar-button"]');
            if (arButton) {
                arButton.innerHTML = 'ðŸ¥½ View in Spatial Reality';
            }
            
        }

        // Initial render
        renderModels();

        function selectModel(index, cardElement) {
            // Remove previous selection
            document.querySelectorAll('.model-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select new model
            cardElement.classList.add('selected');
            selectedModel = models[index];
            
            // Scroll to viewer section smoothly
            const viewerSection = document.querySelector('.viewer-section');
            if (viewerSection) {
                viewerSection.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start'
                });
            }
            
            // Hide placeholder, show loading spinner
            placeholder.style.display = 'none';
            loadingSpinner.style.display = 'block';
            viewer.style.display = 'none';
            
            // Show and update metadata description
            modelDescription.style.display = 'block';
            descriptionTitle.textContent = selectedModel.name;
            
            // Display different metadata based on category
            if (selectedModel.category === 'sites') {
                // Sites and Landscapes: Location and Date
                metadataLabel1.textContent = 'LOCATION';
                metadataValue1.textContent = selectedModel.metadata.location || '';
                metadataLabel2.textContent = 'DATE';
                metadataValue2.textContent = selectedModel.metadata.date || '';
            } else {
                // Objects: Museum and Accession Number
                metadataLabel1.textContent = 'MUSEUM';
                metadataValue1.textContent = selectedModel.metadata.museum || '';
                metadataLabel2.textContent = 'ACCESSION NUMBER';
                metadataValue2.textContent = selectedModel.metadata.accession || '';
            }
            
            metadataDescription.textContent = selectedModel.metadata.description;
            
            // Hide viewer before loading new model
            viewer.style.display = 'none';
            viewer.style.visibility = 'hidden';
            
            // Remove iOS source attribute
            viewer.removeAttribute('ios-src');
            
            // Warn user about large site models
            if (selectedModel.category === 'sites') {
                console.log('Loading large site model:', selectedModel.name);
                loadingSpinner.querySelector('p').textContent = 'Loading large model... this may take 30-60 seconds';
            } else {
                loadingSpinner.querySelector('p').textContent = 'Loading model...';
            }
            
            // Load the new model (this will replace the old one)
            viewer.src = selectedModel.url;
            
            // Set custom camera properties for interior spaces (like Moon Room)
            if (selectedModel.cameraOrbit) {
                viewer.setAttribute('camera-orbit', selectedModel.cameraOrbit);
            }
            if (selectedModel.cameraTarget) {
                viewer.setAttribute('camera-target', selectedModel.cameraTarget);
            }
            if (selectedModel.fieldOfView) {
                viewer.setAttribute('field-of-view', selectedModel.fieldOfView);
            }
            if (selectedModel.minCameraOrbit) {
                viewer.setAttribute('min-camera-orbit', selectedModel.minCameraOrbit);
            }
            if (selectedModel.maxCameraOrbit) {
                viewer.setAttribute('max-camera-orbit', selectedModel.maxCameraOrbit);
            }
            
            // Set rendering properties for interior spaces (unlit, smooth shading)
            if (selectedModel.disableEnvironmentImage) {
                viewer.removeAttribute('environment-image');
            } else {
                viewer.setAttribute('environment-image', 'neutral');
            }
            
            if (selectedModel.shadowIntensity !== undefined) {
                viewer.setAttribute('shadow-intensity', selectedModel.shadowIntensity);
            } else {
                viewer.setAttribute('shadow-intensity', '1');
            }
            
            // Disable zoom for interior spaces (swivel in place)
            if (selectedModel.disableZoom) {
                viewer.setAttribute('disable-zoom', '');
            } else {
                viewer.removeAttribute('disable-zoom');
            }
            
            // Set iOS-specific AR source if provided (for USDZ files)
            if (selectedModel.iosUrl) {
                viewer.setAttribute('ios-src', selectedModel.iosUrl);
            }
            
            // Set up loading complete handler
            let loadHandled = false;
            
            const handleLoadComplete = () => {
                if (loadHandled) return;
                loadHandled = true;
                
                loadingSpinner.style.display = 'none';
                viewer.style.display = 'block';
                viewer.style.visibility = 'visible';
                
            };
            
            // Try multiple events for better reliability
            viewer.addEventListener('load', handleLoadComplete, { once: true });
            viewer.addEventListener('model-visibility', handleLoadComplete, { once: true });
            
            // Fallback timeout in case events don't fire (longer for large site models)
            const timeoutDuration = selectedModel.category === 'sites' ? 60000 : 15000; // 60s for sites, 15s for objects
            setTimeout(() => {
                if (!loadHandled) {
                    console.log('Load timeout - showing model anyway');
                    handleLoadComplete();
                }
            }, timeoutDuration);
            
            // Handle audio button visibility
            if (selectedModel.audio) {
                audioPlayer.src = selectedModel.audio;
                
                // Check if audio file actually exists
                audioPlayer.onerror = () => {
                    console.log('Audio file not found:', selectedModel.audio);
                    playAudioButton.classList.remove('active');
                    audioControls.classList.remove('active');
                    audioPlayer.src = '';
                };
                
                // If audio loads successfully, show button
                audioPlayer.onloadeddata = () => {
                    playAudioButton.classList.add('active');
                };
                
                audioControls.classList.remove('active');
            } else {
                audioPlayer.pause();
                audioPlayer.src = '';
                playAudioButton.classList.remove('active');
                audioControls.classList.remove('active');
            }
            
            // Handle video player visibility and source
            const videoSection = document.getElementById('videoSection');
            const videoPlayer = document.getElementById('videoPlayer');
            const videoSource = document.getElementById('videoSource');
            const videoCaption = document.getElementById('videoCaption');
            const videoPlaceholder = document.getElementById('videoPlaceholder');
            
            if (selectedModel.video) {
                videoSection.style.display = 'block';
                videoSource.src = selectedModel.video;
                
                // Vision Pro optimization: Force load to check compatibility
                videoPlayer.load();
                
                // Add error handler for video loading issues
                videoPlayer.onerror = () => {
                    console.error('Video failed to load:', selectedModel.video);
                    videoPlayer.style.display = 'none';
                    videoPlaceholder.style.display = 'flex';
                    videoPlaceholder.querySelector('p').textContent = 'Video unavailable on this device';
                };
                
                // Show video when it can play
                videoPlayer.onloadeddata = () => {
                    videoPlayer.style.display = 'block';
                    videoPlaceholder.style.display = 'none';
                };
                
                videoCaption.textContent = selectedModel.videoCaption || '';
            } else {
                videoSection.style.display = 'none';
                videoPlayer.pause();
                videoSource.src = '';
                videoPlayer.style.display = 'none';
                videoPlaceholder.style.display = 'flex';
            }
        }

        // Play Audio button click handler
        playAudioButton.addEventListener('click', () => {
            if (selectedModel && selectedModel.audio) {
                audioControls.classList.add('active');
                
                // Enable spatial audio on Vision Pro
                if (isVisionPro && audioPlayer.setSinkId) {
                    audioPlayer.setSinkId('').catch(err => {
                        console.log('Spatial audio setup:', err);
                    });
                }
                
                audioPlayer.play().catch(err => {
                    console.log('Audio play prevented:', err);
                });
            }
        });

        // Add loading indicator
        viewer.addEventListener('load', () => {
            console.log('Model loaded successfully');
        });

        let errorCount = 0;
        let lastErrorModel = '';
        
        viewer.addEventListener('error', (event) => {
            // Ignore errors from clearing the viewer (empty src)
            if (!viewer.src || viewer.src === '' || viewer.src === window.location.href) {
                return;
            }
            
            const currentModel = viewer.src;
            
            // Reset error count if switching to a different model
            if (currentModel !== lastErrorModel) {
                errorCount = 0;
                lastErrorModel = currentModel;
            }
            
            errorCount++;
            console.error('Error loading model (attempt ' + errorCount + '):', currentModel);
            
            // Only show alert after multiple failures (not just network slowness)
            if (errorCount >= 3) {
                console.error('Model failed to load after multiple attempts:', event);
                alert('Error loading 3D model. This model may be too large or the file may be missing. Please try another one.');
                errorCount = 0; // Reset for next attempt
            } else {
                console.log('Retrying model load...');
            }
        });

        }); // End DOMContentLoaded

    </script>
</body>
</html>
